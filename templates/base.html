<!DOCTYPE html>
{% load static %}
{{ form.media }}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">
    
    <!-- Include Bootstrap CSS Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!-- Include Summernote CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs5.min.css" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% block stylesheets %}{% endblock stylesheets %}

    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/logos/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/logos/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/logos/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/logos/site.webmanifest' %}">
    <link rel="mask-icon" href="{% static 'images/logos/safari-pinned-tab.svg' %}" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        
        {% if user.is_authenticated %}
        <a class="navbar-brand" href="#">
        {% else %}
        <a class="navbar-brand" href="{% url 'home_page' %}">
        {% endif %}
            <img src="{% static 'images/logos/navlogo.png' %}" width="53.3" height="43.6" alt="home page logo">
            <img src="{% static 'images/logos/navlogotext.png' %}" width="213.3" height="26.7" alt="home page logo">
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                <!-- Replace Link 1 and Link 2 with a dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-icon-container">
                            <div class="user-initial">{{ request.user.username|slice:":2" }}</div>
                        </div>
                    </a>
                    <!-- Dropdown menu -->
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form action="{% url 'accounts:logout' %}" method="POST">
                                {% csrf_token %}
                                <button class="dropdown-item" type="submit"><i class="bi bi-box-arrow-right"></i> Logout</button>
                            </form>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>    
    </nav>

    <!-- sidebarr -->
    <div class="d-flex">
        <div class="sidebarr bg-light p-3">
            <button class="btn-toggle">
                <i class="bi bi-chevron-left"></i>
            </button>              
            <ul class="sidebarr-content nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#projectsSubMenu" role="button" aria-expanded="false" aria-controls="projectsSubMenu">
                        <span class="link-icon"><i class="bi bi-folder fs-5"></i></span>
                        <span class="link-text">Projects</span>
                    </a>
                    <div class="collapse" id="projectsSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'projects:create_project' %}">Create Project</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'projects:project_list' %}">All Projects</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#phasesSubMenu" role="button" aria-expanded="false" aria-controls="phasesSubMenu">
                        <span class="link-icon"><i class="bi bi-layers fs-5"></i></span>
                        <span class="link-text">Phases</span>
                    </a>
                    <div class="collapse" id="phasesSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'phases:create_phase' %}">Create Phase</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'phases:phase_list' %}">All Phases</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#SegmentsSubMenu" role="button" aria-expanded="false" aria-controls="SegmentsSubMenu">
                        <span class="link-icon"><i class="bi bi-diagram-3 fs-5"></i></span>
                        <span class="link-text">Segments</span>
                    </a>
                    <div class="collapse" id="SegmentsSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'segments:create_segment' %}">Create Segment</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'segments:segment_list' %}">All Segments</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#TagsSubMenu" role="button" aria-expanded="false" aria-controls="TagsSubMenu">
                        <span class="link-icon"><i class="bi bi-tag fs-5"></i></span>
                        <span class="link-text">Tags</span>
                    </a>
                    <div class="collapse" id="TagsSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tags:create_tag' %}">Create Tag</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tags:tag_list' %}">All Tags</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#StagesSubMenu" role="button" aria-expanded="false" aria-controls="StagesSubMenu">
                        <span class="link-icon"><i class="bi bi-list-check fs-5"></i></span>
                        <span class="link-text">Stages</span>
                    </a>
                    <div class="collapse" id="StagesSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'stages:create_stage' %}">Create Stages</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'stages:stage_list' %}">All Stages</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#TicketsSubMenu" role="button" aria-expanded="false" aria-controls="TicketsSubMenu">
                        <span class="link-icon"><i class="bi bi-clipboard fs-5"></i></span>
                        <span class="link-text">Tickets</span>
                    </a>
                    <div class="collapse" id="TicketsSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tickets:create_ticket' %}">Create Ticket</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tickets:ticket_list' %}">All Tickets</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tickets:kanban_board' %}">Kanban board</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#SprintsSubMenu" role="button" aria-expanded="false" aria-controls="SprintsSubMenu">
                        <span class="link-icon"><i class="bi bi-speedometer fs-5"></i></span>
                        <span class="link-text">Sprints</span>
                    </a>
                    <div class="collapse" id="SprintsSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'sprints:create_sprint' %}">Create Sprint</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'sprints:sprint_list' %}">All Sprints</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#MilestonesSubMenu" role="button" aria-expanded="false" aria-controls="MilestonesSubMenu">
                        <span class="link-icon"><i class="bi bi-flag fs-5"></i></span>
                        <span class="link-text">Milestones</span>
                    </a>
                    <div class="collapse" id="MilestonesSubMenu">
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'milestones:create_milestone' %}">Create Milestone</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'milestones:milestone_list' %}">All Milestones</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'milestones:milestone_calendar' %}">Milestone Calendar</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'milestones:milestone_pipeline' %}">Milestone Pipeline</a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            <!-- Bottom Links -->
            <ul class="nav flex-column mt-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'docs' %}">
                        <span class="link-icon"><i class="bi bi-file-earmark-text fs-5"></i></span>
                        <span class="link-text">Docs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <span class="link-icon"><i class="bi bi-gear fs-5"></i></span>
                        <span class="link-text">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="content flex-grow-1 p-3">
            {% block content %}
            {% endblock %}
        </div>
    </div>

    <!-- Include jQuery first -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Include Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>
    <!-- Include Summernote JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs5.min.js"></script>

    <!-- Include SweetAlert via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    {% block endscript %}
    {% endblock %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // datatabe is displaying error message on empty data. currently disabling it.
            $.fn.dataTable.ext.errMode = 'none';

            $('[data-toggle="tooltip"]').tooltip({
                html: true
            });

            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Select the icon inside the clicked nav-link
                    const icon = link.querySelector('.link-icon i');
        
                    if (icon) {
                        // Toggle the fill class for each icon
                        if (icon.classList.contains('bi-folder')) {
                            icon.classList.remove('bi-folder');
                            icon.classList.add('bi-folder-fill');
                        } else if (icon.classList.contains('bi-folder-fill')) {
                            icon.classList.remove('bi-folder-fill');
                            icon.classList.add('bi-folder');
                        }
        
                        if (icon.classList.contains('bi-layers')) {
                            icon.classList.remove('bi-layers');
                            icon.classList.add('bi-layers-fill');
                        } else if (icon.classList.contains('bi-layers-fill')) {
                            icon.classList.remove('bi-layers-fill');
                            icon.classList.add('bi-layers');
                        }
        
                        if (icon.classList.contains('bi-diagram-3')) {
                            icon.classList.remove('bi-diagram-3');
                            icon.classList.add('bi-diagram-3-fill');
                        } else if (icon.classList.contains('bi-diagram-3-fill')) {
                            icon.classList.remove('bi-diagram-3-fill');
                            icon.classList.add('bi-diagram-3');
                        }
        
                        if (icon.classList.contains('bi-tag')) {
                            icon.classList.remove('bi-tag');
                            icon.classList.add('bi-tag-fill');
                        } else if (icon.classList.contains('bi-tag-fill')) {
                            icon.classList.remove('bi-tag-fill');
                            icon.classList.add('bi-tag');
                        }
        
                        if (icon.classList.contains('bi-list-check')) {
                            icon.classList.remove('bi-list-check');
                            icon.classList.add('bi-list');
                        } else if (icon.classList.contains('bi-list')) {
                            icon.classList.remove('bi-list');
                            icon.classList.add('bi-list-check');
                        }
        
                        if (icon.classList.contains('bi-clipboard')) {
                            icon.classList.remove('bi-clipboard');
                            icon.classList.add('bi-clipboard-data');
                        } else if (icon.classList.contains('bi-clipboard-data')) {
                            icon.classList.remove('bi-clipboard-data');
                            icon.classList.add('bi-clipboard');
                        }
        
                        if (icon.classList.contains('bi-speedometer')) {
                            icon.classList.remove('bi-speedometer');
                            icon.classList.add('bi-speedometer2');
                        } else if (icon.classList.contains('bi-speedometer2')) {
                            icon.classList.remove('bi-speedometer2');
                            icon.classList.add('bi-speedometer');
                        }
        
                        if (icon.classList.contains('bi-flag')) {
                            icon.classList.remove('bi-flag');
                            icon.classList.add('bi-flag-fill');
                        } else if (icon.classList.contains('bi-flag-fill')) {
                            icon.classList.remove('bi-flag-fill');
                            icon.classList.add('bi-flag');
                        }
                    }
                });
            });

            const toggleButton = document.querySelector('.btn-toggle');
            const sidebarr = document.querySelector('.sidebarr');
            const collapsibleMenus = document.querySelectorAll('.collapse');
        
            // Toggle sidebarr collapse on button click
            toggleButton.addEventListener('click', function() {
                sidebarr.classList.toggle('collapsed');
                
                // Change icon based on sidebarr state
                if (sidebarr.classList.contains('collapsed')) {
                    toggleButton.innerHTML = '<i class="bi bi-chevron-right"></i>';
                } else {
                    toggleButton.innerHTML = '<i class="bi bi-chevron-left"></i>';
                }
                
                // Collapse all menus when sidebarr is collapsed
                if (sidebarr.classList.contains('collapsed')) {
                    collapsibleMenus.forEach(menu => {
                        if (menu.classList.contains('show')) {
                            menu.classList.remove('show');
                        }
                    });
                }
            });
        
            // Manage sidebarr expansion when menus are expanded
            collapsibleMenus.forEach(menu => {
                menu.addEventListener('show.bs.collapse', function() {
                    // Expand the sidebarr if it's collapsed and a submenu is being opened
                    if (sidebarr.classList.contains('collapsed')) {
                        sidebarr.classList.remove('collapsed');
                        toggleButton.innerHTML = '<i class="bi bi-chevron-left"></i>';
                    }
                    sidebarr.classList.add('expanded');
                });
                
                menu.addEventListener('hide.bs.collapse', function() {
                    // Check if any other menu is expanded
                    const anyMenuExpanded = Array.from(collapsibleMenus).some(menu => menu.classList.contains('show'));
                    if (!anyMenuExpanded) {
                        sidebarr.classList.remove('expanded');
                    }
                });
            });     

    


            // Find all elements with data-toggle attribute
            var elements = document.querySelectorAll('[data-toggle]');
            elements.forEach(function(element) {
                // Get the value of the data-toggle attribute
                var toggleValue = element.getAttribute('data-toggle');
                // Set the value to data-bs-toggle attribute
                element.setAttribute('data-bs-toggle', toggleValue);
                // Remove the old data-toggle attribute
                element.removeAttribute('data-toggle');
            });
    
            // Repeat the process for other attributes if needed
            // Example: data-target to data-bs-target
            elements = document.querySelectorAll('[data-target]');
            elements.forEach(function(element) {
                var targetValue = element.getAttribute('data-target');
                element.setAttribute('data-bs-target', targetValue);
                element.removeAttribute('data-target');
            });
        });
    </script>
    <!-- Save scroll position before page unload -->
    <script>
        window.onbeforeunload = function() {
            localStorage.setItem('scrollPosition', window.scrollY);
        };  
    </script>

    <!-- Restore scroll position after page load -->
    <script>
        window.onload = function() {
            if (localStorage.getItem('scrollPosition') !== null) {
            window.scrollTo(0, localStorage.getItem('scrollPosition'));
            }
        };
    </script>
</body>
</html>
